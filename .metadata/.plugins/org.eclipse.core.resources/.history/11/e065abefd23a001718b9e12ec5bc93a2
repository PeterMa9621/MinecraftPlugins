package personalQuest;

import org.bukkit.plugin.java.JavaPlugin;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;

import org.bukkit.Bukkit;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.configuration.file.YamlConfiguration;
import org.bukkit.entity.Player;

public class PersonalQuest extends JavaPlugin
{
	
	HashMap<String, ArrayList<String>> quests = new HashMap<String, ArrayList<String>>();
	/** The first index of ArrayList which is in the HashMap is about the TYPE of the quest
	    The second index of ArrayList is about the NAME of the quest
	    The third index of ArrayList is about the DESCRIPTION of the quest(every line separates with %)
	**/ 


	public void onEnable() 
	{
		if(!getDataFolder().exists()) 
		{
			getDataFolder().mkdir();
		}
		getServer().getPluginManager().registerEvents(new PersonalQuestListener(this), this);
		Bukkit.getConsoleSender().sendMessage("§a[PersonalQuest] §e任务系统加载完毕");
	}

	public void onDisable() 
	{
		Bukkit.getConsoleSender().sendMessage("§a[PersonalQuest] §e任务系统卸载完毕");
	}

	public FileConfiguration load(File file)
	{
        if (!(file.exists())) 
        { //假如文件不存在
        	try   //捕捉异常，因为有可能创建不成功
        	{
        		file.createNewFile();
        	}
        	catch(IOException e)
        	{
        		e.printStackTrace();
        	}
        }
        return YamlConfiguration.loadConfiguration(file);
	}
	public FileConfiguration load(String path)
	{
		File file=new File(path);
		if(!file.exists())
		{
			try
		{
				file.createNewFile();
		}
			catch(IOException e)
			{
				e.printStackTrace();
			}
		}
		return YamlConfiguration.loadConfiguration(new File(path));
	}
	
	public boolean onCommand(CommandSender sender,Command cmd,String label,String[] args)  
	{
		if (cmd.getName().equalsIgnoreCase("pvp"))
		{
			File file=new File(getDataFolder(), "/player/"+sender.getName()+".yml");
			FileConfiguration config;
			config = load(file);
			if (args.length==0)
			{
				if(sender instanceof Player)
				{
					
					if(config.getBoolean("PVP.onUse")==false)
					{
						sender.sendMessage("§a[PVP]§3PVP已打开");
						config.set("PVP.onUse", true);
					}
					else
					{
						sender.sendMessage("§a[PVP]§3PVP已关闭");
						config.set("PVP.onUse", false);
					}
					try 
					{
						config.save(file);
					} 
					catch (IOException e) 
					{
						e.printStackTrace();
					}
				}
				return true;
			}
			
			if(args[0].equalsIgnoreCase("help"))
			{
				sender.sendMessage("§a=========[PVP系统]=========");
				sender.sendMessage("§a/pvp state §3查看当前PVP开关状态");
				sender.sendMessage("§a/pvp help §3查看帮助");
				if(sender.isOp())
				{
					sender.sendMessage("§a/pvp on §3强制打开PVP");
					sender.sendMessage("§a/pvp off §3强制关闭PVP");
				}
				return true;
			}
			
			if(args[0].equalsIgnoreCase("on"))
			{
				config.set("PVP.onUse", true);
				try {
					config.save(file);
				} catch (IOException e) {
					e.printStackTrace();
				}
				return true;
			}
			
			if(args[0].equalsIgnoreCase("off"))
			{
				config.set("PVP.onUse", false);
				try {
					config.save(file);
				} catch (IOException e) {
					e.printStackTrace();
				}
				return true;
			}
			
			if(args[0].equalsIgnoreCase("state"))
			{
				if(config.getBoolean("PVP.onUse")==false)
					sender.sendMessage("§a[PVP]§3你的PVP为关闭状态");
				else
					sender.sendMessage("§a[PVP]§3你的PVP为打开状态");
				return true;
			}
			
		}

		return false;
		
	}
	
	
}

