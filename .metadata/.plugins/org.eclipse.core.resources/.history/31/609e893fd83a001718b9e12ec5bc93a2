package personalQuest;

import org.bukkit.plugin.java.JavaPlugin;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.configuration.file.YamlConfiguration;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.inventory.Inventory;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.ItemMeta;

public class PersonalQuest extends JavaPlugin
{
	
	HashMap<String, ArrayList<String>> quests = new HashMap<String, ArrayList<String>>();
	/** The first index of ArrayList which is in the HashMap is about the TYPE of the quest
	    The second index of ArrayList is about the NAME of the quest
	    The third index of ArrayList is about the DESCRIPTION of the quest(every line separates with %)
	**/ 


	public void onEnable() 
	{
		if(!getDataFolder().exists()) 
		{
			getDataFolder().mkdir();
		}
		getServer().getPluginManager().registerEvents(new PersonalQuestListener(this), this);
		Bukkit.getConsoleSender().sendMessage("§a[PersonalQuest] §e任务系统加载完毕");
	}

	public void onDisable() 
	{
		Bukkit.getConsoleSender().sendMessage("§a[PersonalQuest] §e任务系统卸载完毕");
	}

	public FileConfiguration load(File file)
	{
        if (!(file.exists())) 
        { //假如文件不存在
        	try   //捕捉异常，因为有可能创建不成功
        	{
        		file.createNewFile();
        	}
        	catch(IOException e)
        	{
        		e.printStackTrace();
        	}
        }
        return YamlConfiguration.loadConfiguration(file);
	}
	public FileConfiguration load(String path)
	{
		File file=new File(path);
		if(!file.exists())
		{
			try
		{
				file.createNewFile();
		}
			catch(IOException e)
			{
				e.printStackTrace();
			}
		}
		return YamlConfiguration.loadConfiguration(new File(path));
	}
	
	public Inventory initMain(Player p)
	{
		Inventory inv = Bukkit.createInventory(p, 9, "§5任务系统");
		ItemStack quest = new ItemStack(Material.BOOK);
		ItemMeta meta = quest.getItemMeta();
		meta.setDisplayName("§e点击打开任务平台");
		quest.setItemMeta(meta);
		quest.addUnsafeEnchantment(Enchantment.getById(48), 5);
		
		ItemStack job = new ItemStack(Material.PAPER);
		ItemMeta metaJob = job.getItemMeta();
		metaJob.setDisplayName("§e点击打开招聘平台");
		job.setItemMeta(metaJob);
		job.addUnsafeEnchantment(Enchantment.getById(33), 5);
		
		
		inv.setItem(2, quest);
		inv.setItem(4, job);

		return inv;
	}
	
	public Inventory initQuestGUI(Player p)
	{
		Inventory inv = Bukkit.createInventory(p, 54, "§5任务平台");
		ItemStack previous = new ItemStack(351,1,(short)13);
		ItemMeta meta = previous.getItemMeta();
		meta.setDisplayName("§e点击打开下一页");
		previous.setItemMeta(meta);
		previous.addUnsafeEnchantment(Enchantment.getById(48), 5);
		
		ItemStack next = new ItemStack(351,1,(short)8);
		ItemMeta metaNext = next.getItemMeta();
		metaNext.setDisplayName("§e点击打开上一页");
		next.setItemMeta(metaNext);
		next.addUnsafeEnchantment(Enchantment.getById(33), 5);
		

		inv.setItem(45, previous);
		inv.setItem(53, next);

		return inv;
	}
	
	public boolean onCommand(CommandSender sender,Command cmd,String label,String[] args)  
	{
		if (cmd.getName().equalsIgnoreCase("pq"))
		{
			if(args.length==0)
			{
				sender.sendMessage("§a=========[任务系统]=========");
				sender.sendMessage("§a/pq my §3查看我的任务");
				if(sender.isOp())
				{
					sender.sendMessage("§a/pq reload §3重载配置");
				}
				return true;
			}
			
			if(args[0].equalsIgnoreCase("my"))
			{

			}
			return true;
		}
		return false;
	}
}

